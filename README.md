# üèä‚Äç‚ôÇÔ∏è Swim-Pool Service

REST-–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ Java / Spring Boot, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –±–∞—Å—Å–µ–π–Ω–∞  
(—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏ –Ω–∞ –ø–æ—Å–µ—â–µ–Ω–∏–µ).

* **–°—Ç–µ–∫:** Spring Boot 3 ‚ûú Web MVC, Validation, Spring Data JPA, PostgreSQL
* **–ü—Ä–æ—Ñ–∏–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** H2 in-memory, JUnit 5 + Mockito
* **–°–±–æ—Ä–∫–∞:** Maven
* **CI:** GitLab CI (—é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã, –ª–∏–Ω—Ç–µ—Ä, —Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞)

---

## üìå –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ                            | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è                                                                          |
|---------------------------------------|-------------------------------------------------------------------------------------|
| –ó–∞–ø–∏—Å—å **—Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã**      | –¢–∞–±–ª–∏—Ü—ã `working_schedule` –∏ `schedule_exception` + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `ReservationService` |
| **–õ–∏–º–∏—Ç 10** –∑–∞–ø–∏—Å–µ–π –Ω–∞ —á–∞—Å           | —Å–µ—Ä–≤–∏—Å —Å—á–∏—Ç–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∑–∞–≥—Ä—É–∑–∫—É (`countByStartTime`), –ë–î ‚Äî –∏–Ω–¥–µ–∫—Å                   |
| –ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π –ø–æ **–§–ò–û / –¥–∞—Ç–µ**       | GET `/api/v0/pool/timetable/search?name=&date=`                                     |
| –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–ª—è **–ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤** | `schedule_exception` (is_working = true/false)                                      |
| **‚â§ 1 –∑–∞–ø–∏—Å—å/–¥–µ–Ω—å/–∫–ª–∏–µ–Ω—Ç–∞**           | —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π UNIQUE-–∏–Ω–¥–µ–∫—Å `ux_res_client_day`                                    |
| –ó–∞–ø–∏—Å—å –Ω–∞ **–Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –ø–æ–¥—Ä—è–¥**  | –ø–æ–ª–µ `hours`, —Å–µ—Ä–≤–∏—Å –±—Ä–æ–Ω–∏—Ä—É–µ—Ç N —á–∞—Å–æ–≤—ã—Ö —Å–ª–æ—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ                       |

---

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# 1. –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–º. .env.example)
export SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/pool
export SPRING_DATASOURCE_USERNAME=pool
export SPRING_DATASOURCE_PASSWORD=secret

# 2. —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
./mvnw clean package
java -jar target/pool-service.jar
```

---

## üìö HTTP-API (–∫—Ä–∞—Ç–∫–æ)

| Method     | URL                                                | –û–ø–∏—Å–∞–Ω–∏–µ         |
|------------|----------------------------------------------------|------------------|
| **GET**    | `/api/v0/pool/client/all`                          | —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤  |
| **GET**    | `/api/v0/pool/client/get?id={id}`                  | –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç      |
| **POST**   | `/api/v0/pool/client/add`                          | —Å–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞  |
| **PUT**    | `/api/v0/pool/client/update`                       | –æ–±–Ω–æ–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ |
| **GET**    | `/api/v0/pool/timetable/all?date=YYYY-MM-DD`       | –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã    |
| **GET**    | `/api/v0/pool/timetable/available?date=YYYY-MM-DD` | —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã  |
| **POST**   | `/api/v0/pool/timetable/reserve`                   | –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å    |
| **DELETE** | `/api/v0/pool/timetable/cancel`                    | –æ—Ç–º–µ–Ω–∏—Ç—å         |
| **GET**    | `/api/v0/pool/timetable/search?name=&date=`        | –ø–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π    |


---

## üóÑÔ∏è –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

> SQL‚Äë–º–∏–≥—Ä–∞—Ü–∏–∏: `src/main/resources/schema-prod.sql`

### –¢–∞–±–ª–∏—Ü–∞ `clients`

| –∫–æ–ª–æ–Ω–∫–∞    | —Ç–∏–ø            | –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è               |
|------------|----------------|---------------------------|
| id         | `BIGINT`       | PK, GENERATED AS IDENTITY |
| name       | `VARCHAR(256)` | **NOT NULL**              |
| phone      | `VARCHAR(50)`  | **UNIQUE, NOT NULL**      |
| email      | `VARCHAR(256)` | **UNIQUE, NOT NULL**      |
| created_at | `TIMESTAMPTZ`  | default `now()`           |

–ò–Ω–¥–µ–∫—Å—ã: `idx_client_name` –ø–æ –ø–æ–ª—é `name` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞.

---

### –¢–∞–±–ª–∏—Ü–∞ `working_schedule`

| –∫–æ–ª–æ–Ω–∫–∞     | —Ç–∏–ø    | –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π       |
|-------------|--------|-------------------|
| day_of_week | `INT`  | PK; 1=Mon ‚Ä¶ 7=Sun |
| start_time  | `TIME` | –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã     |
| end_time    | `TIME` | –∫–æ–Ω–µ—Ü —Ä–∞–±–æ—Ç—ã      |

Constraint `chk_working_schedule` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ `end_time > start_time`.

---

### –¢–∞–±–ª–∏—Ü–∞ `schedule_exception`

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –∏ –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω–Ω—ã—Ö –¥–Ω–µ–π.

| –∫–æ–ª–æ–Ω–∫–∞        | —Ç–∏–ø             | –æ–ø–∏—Å–∞–Ω–∏–µ                    |
|----------------|-----------------|-----------------------------|
| exception_date | `DATE` PK       |
| is_working     | `BOOLEAN`       | `false` ‚Üí –±–∞—Å—Å–µ–π–Ω –∑–∞–∫—Ä—ã—Ç    |
| start_time     | `TIME` nullable | –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã (–µ—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç) |
| end_time       | `TIME` nullable | –∫–æ–Ω–µ—Ü —Ä–∞–±–æ—Ç—ã                |

–ü—Ä–æ–≤–µ—Ä–∫–∞ `chk_schedule_is_working` –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç —É–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–æ–≥–æ –¥–Ω—è –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.

---

### –¢–∞–±–ª–∏—Ü–∞ `reservation`

| –∫–æ–ª–æ–Ω–∫–∞               | —Ç–∏–ø                        | –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è                                |
|-----------------------|----------------------------|--------------------------------------------|
| id                    | `BIGSERIAL` PK             |
| client_id             | `BIGINT` FK ‚Üí `clients.id` |
| start_time / end_time | `TIMESTAMPTZ`              | **—Ü–µ–ª–æ—á–∞—Å–æ–≤—ã–µ**, `end_time > start_time`   |
| order_id              | `UUID`                     | **UNIQUE** ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±—Ä–æ–Ω–∏ |
| created_at            | `TIMESTAMPTZ`              | default `now()`                            |

–ö–ª—é—á–µ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```sql
-- –∑–∞–ø—Ä–µ—Ç –≤—Ç–æ—Ä–æ–π –∑–∞–ø–∏—Å–∏ —Ç–æ–≥–æ –∂–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å
CREATE UNIQUE INDEX ux_res_client_day
    ON reservation (client_id, (start_time::date));

-- —É—Å–∫–æ—Ä—è–µ–º –ø–æ–¥—Å—á—ë—Ç –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ —á–∞—Å–∞
CREATE INDEX idx_res_time ON reservation (start_time);

-- –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ¬´—Ä–æ–≤–Ω–æ –Ω–∞ —á–∞—Å–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã¬ª
CONSTRAINT chk_reservation_time
  CHECK (
    date_part('minute', start_time) = 0
    AND date_part('second', start_time) = 0
    AND date_part('minute', end_time)   = 0
    AND date_part('second', end_time)   = 0
  );
```

---

## üõ†Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –£—Ä–æ–≤–µ–Ω—å | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã      | –ü–æ–∫—Ä—ã—Ç–∏–µ              |
|---------|------------------|-----------------------|
| Unit    | JUnit 5, Mockito | —Å–µ—Ä–≤–∏—Å—ã, ErrorHandler |
| Web     | Spring MockMvc   | –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã           |

```bash
./mvnw test
```

---
